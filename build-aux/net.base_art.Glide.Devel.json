{
  "app-id": "net.base_art.Glide.Devel",
  "runtime": "org.gnome.Platform",
  "runtime-version": "49",
  "sdk": "org.gnome.Sdk",
  "sdk-extensions": [
    "org.freedesktop.Sdk.Extension.rust-stable"
  ],
  "cleanup": [
    "/include"
  ],
  "command": "glide",
  "finish-args": [
    "--device=dri",
    "--filesystem=xdg-download:ro",
    "--filesystem=xdg-videos:ro",
    "--filesystem=xdg-music:ro",
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland"
  ],
  "build-options": {
    "append-path": "/usr/lib/sdk/rust-stable/bin",
    "env": {
      "CARGO_HOME": "/run/build/glide/cargo"
    }
  },
  "modules": [
    {
      "name": "libass",
      "config-opts": [ "--enable-shared", "--disable-static" ],
      "sources": [
        {
            "type": "git",
            "url": "https://github.com/libass/libass.git",
            "tag": "0.17.4",
            "commit": "bbb3c7f1570a4a021e52683f3fbdf74fe492ae84"
        },
        {
            "type":"script",
            "commands":[
                "autoreconf -fiv"
            ],
            "dest-filename":"autogen.sh"
        }
      ]
    },
    {
      "name": "gstreamer",
      "builddir": true,
      "buildsystem": "meson",
      "sources": [
        {
          "type": "git",
          "url": "https://gitlab.freedesktop.org/gstreamer/gstreamer",
          "tag": "1.26.6",
          "disable-submodules": true
        }
      ],
      "config-opts": [
          "-Ddoc=disabled",
          "-Dlibav=disabled",
          "-Dtests=disabled",
          "-Ddevtools=disabled",
          "-Dges=disabled",
          "-Drtsp_server=disabled",
          "-Dgst-examples=disabled",
          "-Dpython=disabled",
          "-Dwebrtc=disabled",
          "-Dgpl=enabled",
          "-Dgst-plugins-ugly:gpl=enabled",
          "-Dgst-plugins-bad:gpl=enabled",
          "-Dgst-plugins-bad:openh264=disabled"
      ]
    },
    {
      "name": "gtuber",
      "buildsystem": "meson",
      "config-opts": [
          "-Dintrospection=disabled",
          "-Dvapi=disabled",
          "-Dgst-gtuber=enabled"
      ],
      "cleanup": [
          "/include",
          "/lib/pkgconfig"
      ],
      "sources": [
          {
              "type": "git",
              "url": "https://github.com/Rafostar/gtuber.git",
              "branch": "main"
          }
      ]
    },
    {
      "name": "glide",
      "buildsystem": "simple",
      "build-commands": [
        "cargo --offline fetch --manifest-path Cargo.toml",
        "cargo --offline build --release --features wayland,x11egl,x11glx,dmabuf,devel",
        "install -Dm755 ./target/release/glide -t /app/bin/",
        "install -Dm644 ./data/net.base_art.Glide.metainfo.xml -t /app/share/metainfo/",
        "mv /app/share/metainfo/net.base_art.Glide{,.Devel}.metainfo.xml",
        "sed -i 's/net.base_art.Glide/net.base_art.Glide.Devel/g' /app/share/metainfo/net.base_art.Glide.Devel.metainfo.xml",
        "install -Dm644 ./data/net.base_art.Glide.desktop -t /app/share/applications/",
        "mv /app/share/applications/net.base_art.Glide{,.Devel}.desktop",
        "sed -i 's/net.base_art.Glide/net.base_art.Glide.Devel/g' /app/share/applications/net.base_art.Glide.Devel.desktop",
        "sed -i 's/=Glide/=Glide Tech Preview/g' /app/share/applications/net.base_art.Glide.Devel.desktop",
        "install -Dm644 ./data/net.base_art.Glide.Devel.svg -t /app/share/icons/hicolor/scalable/apps/"
      ],
      "sources": [
        {
          "type": "dir",
          "path": ".."
        },
        "../cargo-sources.json"
      ]
    }
  ]
}
